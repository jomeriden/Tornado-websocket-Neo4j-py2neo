<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>EPCC-INF</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
        #menu {
            background: #fff;
            position: absolute;
            z-index: 1;
            top: 10px;
            right: 10px;
            border-radius: 3px;
            width: 120px;
            border: 1px solid rgba(0,0,0,0.4);
            font-family: 'Open Sans', sans-serif;
        }

        #menu a {
            font-size: 13px;
            color: #404040;
            display: block;
            margin: 0;
            padding: 0;
            padding: 10px;
            text-decoration: none;
            border-bottom: 1px solid rgba(0,0,0,0.25);
            text-align: center;
        }

        #menu a:last-child {
            border: none;
        }

        #menu a:hover {
            background-color: #f8f8f8;
            color: #404040;
        }

        #menu a.active {
            background-color: #3887be;
            color: #ffffff;
        }

        #menu a.active:hover {
            background: #3074a4;
        }
        .marker {
            background-image: url('img/sensor.png');
            background-size: cover;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
        }
        .marker1 {
            background-image: url('img/sensor.png');
            background-size: cover;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
        }


    </style>
</head>
<body>
<nav id="menu"></nav>
<div id='map'></div>
<script>
    $(document).ready(function () {

        var ws;
        ws = new WebSocket("ws://158.49.245.167:8080/ws");

        // Handle incoming websocket message callback
        ws.onmessage = function(evt) {
            alert("message received");
        };

        // Close Websocket callback
        ws.onclose = function() {
            alert("Connection close");

        };

        // Open Websocket callback
        ws.onopen = function() {
            alert("connection open")
        };
    });




    mapboxgl.accessToken = 'pk.eyJ1Ijoiam9tZXJpZGVuIiwiYSI6ImNqY3VhZHl6aDB0bWIyd3BnczV1NWpzYmkifQ.rOAbP1Hp8Z85ywg8qIL--A';
    var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/jomeriden/cjd080bq11arr2tmow85l3ph1',
        center: [ -6.342167, 39.478944 ], // starting position
        maxZoom: 19,
        minZoom: 19,
        zoom: 19 // starting zoom
    });



    var geojson = {type: 'FeatureCollection',
        features: [
            {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34212121285005, 39.4789358451573 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "Smart Politech TV Inform\u00e1tica"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34218641527551, 39.4790312703844 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Pasillo"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34230284817811, 39.478634862672 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "Contador agua inform\u00e1tica planta baja hombres"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34227236392725, 39.4787832298795 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Lab. F\u00edsica"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34227744463573, 39.4789126424273 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Lab. Electr\u00f3nica"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34222452058909, 39.4790276756012 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THC Sala Reuniones Robolab"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34230030782387, 39.4790309435863 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "Sensor de consumo el\u00e9ctrico de Salareuniones-Robolab (ACHO)"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34217540707381, 39.479070486194 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THV Robolab 1"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34221393577976, 39.4792626433394 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Aula 1"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34204415543815, 39.4791273490781 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THV Cuarto SAI"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.3420166349339, 39.4791097019811 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "Wibeee prueba"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34204881275425, 39.4791155843472 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "Consumo Elect. SAI"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.3420433086534, 39.4790319239818 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Lab. 2"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34211982307014, 39.4789114933231 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THV Despacho Inform\u00e1ticos"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34217526414829, 39.4787499242323 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Lab. Digitales"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34221154672164, 39.4786407065381 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "Contador Agua inform\u00e1tica p. baja mujeres"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34223175832524, 39.47862024828 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THV Cuarto servidores"'
    }
  }
        ]};

    var geojson1 = {type: 'FeatureCollection',
        features: [
            {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34228464230607, 39.4787721186899 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Despacho Lorenzo"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34225923876368, 39.4788799625138 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Despacho"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34215889477126, 39.4790930352743 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Aula I5"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34214915674668, 39.4791979374211 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Novell"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34208099057461, 39.4792410747068 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' ""'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34199546531524, 39.4791655844395 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THC Norba"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34206617184155, 39.4790812705377 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Sala 1"'
    }
  }, {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [ -6.34210089001614, 39.4788476093841 ]
    },
    properties: {
      title: 'Escuela Politecnica Caceres - Edificio Informatica',
      description: ' "THR Despacho Luz (secretaria)"'
    }
  }
        ]};

    geojson.features.forEach(function(marker) {

        // create a HTML element for each feature
        var el = document.createElement('div');
        el.className = 'marker';

        // make a marker for each feature and add to the map
        new mapboxgl.Marker(el)
            .setLngLat(marker.geometry.coordinates)
            .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>'))
            .addTo(map);
    });

    geojson1.features.forEach(function(marker) {

        // create a HTML element for each feature
        var el = document.createElement('div');
        el.className = 'marker1';

        // make a marker for each feature and add to the map
        new mapboxgl.Marker(el)
            .setLngLat(marker.geometry.coordinates)
            .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>'))
            .addTo(map);
    });

    map.on('load', function () {
        map.addLayer({
            "id": "EPCC-INF-00",
            "source": {
                "type": "raster",
                "url": "mapbox://jomeriden.bocq0xw7"
            },
            "type": "raster"
        });
        map.addLayer({
            "id": "EPCC-INF-01",
            "source": {
                "type": "raster",
                "url": "mapbox://jomeriden.bodub7zc"
            },
            "layout": {
                "visibility": "none"
            },
            "type": "raster"
        });
        map.addLayer({
            'id': 'maine',
            'type': 'fill',
            'source': {
                'type': 'geojson',
                'data': {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Polygon',
                        'coordinates': [[[-6.34220372242568, 39.4793228175059],
                            [-6.34187879809926, 39.4792546328079],
                            [-6.34203009098874, 39.4788224029669],
                            [-6.34205598339601, 39.4788278891285],
                            [-6.34214076833743, 39.4785900244351],
                            [-6.34241441554359, 39.478648413043],
                            [-6.34233166137921, 39.4788862775367],
                            [-6.34235755378647, 39.4788909799567],
                            [-6.34220372242568, 39.4793228175059]]]
                    }
                }
            },
            'layout': {},
            'paint': {
                'fill-color': '#088',
                'fill-opacity': 0.5
            }
        });
    });

    var toggleableLayerIds = [ 'EPCC-INF-00', 'EPCC-INF-01' ];

    for (var i = 0; i < toggleableLayerIds.length; i++) {
        var id = toggleableLayerIds[i];

        var link = document.createElement('a');
        link.href = '#';
        if (i === 0){
            link.className = 'active';
        }else{
            link.className = '';
            var markersNoneInit = document.getElementsByClassName('marker1'), i;
            for (var i = 0; i < markersNoneInit.length; i++) {
                markersNoneInit[i].style.display = 'none';
            }
        }

        link.textContent = id;

        link.onclick = function (e) {
            var clickedLayer = this.textContent;
            e.preventDefault();
            e.stopPropagation();

            var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

            if (visibility === 'visible') {
                map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                this.className = '';
                if (this.textContent === 'EPCC-INF-00'){
                    var markers00 = document.getElementsByClassName('marker'), i;
                    for (var i = 0; i < markers00.length; i++) {
                        markers00[i].style.display = 'none';
                    }
                }else{
                    var markers01 = document.getElementsByClassName('marker1'), i;
                    for (var i = 0; i < markers01.length; i++) {
                        markers01[i].style.display = 'none';
                    }
                }
            } else {
                this.className = 'active';
                map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                if (this.textContent === 'EPCC-INF-00') {
                    var markers00 = document.getElementsByClassName('marker'), i;
                    for (var i = 0; i < markers00.length; i ++) {
                        markers00[i].style.display = '';
                    }
                }else{
                    var markers01 = document.getElementsByClassName('marker1'), i;
                    for (var i = 0; i < markers01.length; i++) {
                        markers01[i].style.display = '';
                    }
                }
            }
        };

        var layers = document.getElementById('menu');
        layers.appendChild(link);
    }
</script>


</body>
</html>